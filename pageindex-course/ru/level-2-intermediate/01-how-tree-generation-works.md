---
title: "Как работает генерация дерева"
weight: 1
bookToc: true
---

# Как работает генерация дерева

## Двухэтапный процесс

PageIndex работает в два основных этапа:

1. **Генерация индекса** — построение древовидной структуры из документа
2. **Поиск по дереву** — использование дерева для нахождения релевантной информации

Этот урок посвящён первому этапу.

## Шаг 1: Обнаружение оглавления

PageIndex начинает с просмотра первых страниц документа (по умолчанию 20) и проверяет наличие оглавления (TOC).

Система использует LLM для анализа каждой страницы: *«Содержит ли эта страница оглавление?»*

Три возможных сценария:

| Сценарий | Действие PageIndex |
|----------|-------------------|
| Оглавление с номерами страниц | Извлекает TOC и сопоставляет с физическими страницами |
| Оглавление без номеров страниц | Извлекает TOC, затем сканирует документ для поиска страниц |
| Оглавление не найдено | Генерирует структуру, анализируя весь документ |

## Шаг 2: Сопоставление номеров страниц

Если оглавление содержит номера страниц, PageIndex вычисляет **смещение** — разницу между печатными номерами страниц и фактическими номерами в PDF. Например, если «Глава 1» указана как «страница 1», но физически находится на 5-й странице PDF, смещение равно 4.

## Шаг 3: Верификация

После построения дерева PageIndex проверяет точность:

1. Для каждого раздела проверяет: *«Действительно ли название этого раздела появляется на указанной странице?»*
2. Если точность выше 60% — пытается исправить неверные записи
3. Если точность слишком низкая — переключается на другую стратегию

## Шаг 4: Обработка больших узлов

Если раздел охватывает слишком много страниц (более 10) или токенов (более 20 000), PageIndex рекурсивно разбивает его на подразделы.

## Стратегия резервного перехода

```
Попробовать TOC с номерами страниц
    ↓ (если точность < 60%)
Попробовать TOC без номеров страниц
    ↓ (если точность < 60%)
Сгенерировать структуру с нуля
```

Это обеспечивает надёжные результаты независимо от качества документа.

## Итоги

Генерация дерева — это интеллектуальный многоэтапный процесс: обнаружение оглавления, сопоставление страниц, верификация точности и обработка сложных случаев. Система адаптирует стратегию, всегда стремясь к максимально точному дереву.
