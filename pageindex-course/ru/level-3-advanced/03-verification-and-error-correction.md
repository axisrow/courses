---
title: "Верификация и исправление ошибок"
weight: 3
bookToc: true
---

# Верификация и исправление ошибок

## Зачем нужна верификация

LLM могут ошибаться. Сгенерированное дерево может привязать раздел к неправильной странице. PageIndex включает надёжную систему верификации и коррекции.

## Процесс верификации

### Шаг 1: Проверка появления названия

Для каждого раздела PageIndex спрашивает LLM: *«Появляется ли название этого раздела на этой странице?»*

Функция `check_title_appearance` использует нечёткое сравнение для обработки различий в форматировании.

### Шаг 2: Расчёт точности

```
точность = правильные / всего_проверено
```

### Шаг 3: Логика принятия решений

| Точность | Действие |
|----------|----------|
| 100% | Принять дерево как есть |
| 60-99% | Попытаться исправить неверные записи |
| Менее 60% | Перейти к другой стратегии |

## Процесс исправления ошибок

Для каждой неверной записи PageIndex:

1. **Находит границы** — ближайшие правильные записи до и после неверной
2. **Извлекает диапазон страниц** — текст между этими границами
3. **Спрашивает LLM** — «Где в этом тексте начинается данный раздел?»
4. **Проверяет исправление** — верна ли новая привязка страницы

### Логика повторов

Процесс коррекции использует до 3 попыток:

```
Раунд 1: Исправить все неверные записи
  ↓ (проверить результаты)
Раунд 2: Исправить оставшиеся
  ↓ (проверить результаты)
Раунд 3: Исправить оставшиеся
  ↓ (принять то, что осталось)
```

## Защитные проверки

### Валидация физических индексов

Перед верификацией PageIndex проверяет:
- Ни один номер страницы не превышает длину документа
- Номера страниц — положительные целые числа
- Записи с невозможными номерами обнуляются

### Проверка позиции начала

PageIndex также проверяет, начинается ли раздел в **начале** указанной страницы или в её середине.

## Цепочка откатов

Если верификация показывает ненадёжность дерева:

1. **TOC с номерами страниц** → точность низкая → откат к:
2. **TOC без номеров страниц** → точность низкая → откат к:
3. **Генерация с нуля** → если неудача → исключение

## Итоги

Система верификации PageIndex проверяет каждую привязку раздела к странице, исправляет ошибки итеративно и откатывается к альтернативным стратегиям при необходимости. Этот многоуровневый подход обеспечивает точность 98%+.
