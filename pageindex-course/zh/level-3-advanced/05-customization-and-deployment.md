---
title: "自定义与部署"
weight: 5
bookToc: true
---

# 自定义与部署

## 根据需求定制 PageIndex

PageIndex 设计为可定制的。本课介绍如何针对特定场景进行调优和生产部署。

## 配置调优

### 模型选择

默认模型是 `gpt-4o-2024-11-20`，但可以使用任何兼容 OpenAI 的模型：

```python
result = page_index("document.pdf", model="gpt-4o-mini")
```

权衡：
- **GPT-4o**：准确率最高，成本较高，速度较慢
- **GPT-4o-mini**：准确率不错，成本较低，速度较快

### 节点大小参数

控制树的详细程度：

```python
result = page_index(
    "document.pdf",
    max_page_num_each_node=5,      # 越小 = 树越详细
    max_token_num_each_node=10000   # 越小 = 拆分越多
)
```

### 目录检测范围

```python
result = page_index(
    "document.pdf",
    toc_check_page_num=30  # 扫描更多页面查找目录
)
```

对于目录出现较晚的文档（如有长序言），可以增加此值。

## 部署选项

### 选项一：自托管（本地）

在自己的机器或服务器上运行。

**优点**：完全控制、数据留在自己的基础设施上、无使用限制
**缺点**：需要自己的 API 密钥、需要管理基础设施

### 选项二：云端 API

使用托管的 PageIndex API。

**优点**：无需设置、托管基础设施、始终保持最新
**缺点**：数据离开您的网络、按量计费

### 选项三：企业部署

适用于大型组织：私有云或本地部署、自定义模型集成、批量定价、专属支持。

## 生产环境注意事项

### 成本管理

每次文档处理需要多次 API 调用。管理成本的方法：
1. **缓存结果** — 存储生成的树以便重用
2. **分级使用模型** — 初步处理用小模型，验证用大模型
3. **设置合适的节点大小** — 更大的节点意味着更少的 API 调用
4. **批量处理** — 在非高峰时段处理文档

### 性能优化

- **并发**：PageIndex 已使用异步处理，确保系统支持并发 API 调用
- **缓存**：存储树结构避免重复处理同一文档
- **预处理**：为文档库预先生成树；树搜索本身很快

### 错误处理

生产环境中需要处理：
- API 速率限制（实现指数退避）
- 没有有用结构的文档（提供回退响应）
- 超大文档（设置合适的超时）
- 损坏或加密的 PDF（处理前验证）

## 扩展 PageIndex

您可以通过以下方式扩展系统：
1. **自定义后处理** — 向树节点添加自定义字段
2. **替代模型** — 适配非 OpenAI 模型的 API 函数
3. **领域特定提示词** — 为您的领域修改提示词以获得更好的结果
4. **集成层** — 为特定用例构建封装

## 总结

PageIndex 可以通过配置参数进行定制，支持多种部署方式（本地、云端、企业），并可为特定用例进行扩展。生产部署应考虑成本管理、缓存和健壮的错误处理。
