---
title: "高级多代理工作流"
weight: 11
bookToc: true
---

# 高级多代理工作流

## 超越单一代理

初级阶段你用了单个代理。中级阶段学了 NTM 并行工作。现在来编排 **复杂的多代理工作流**。

### 模式1：分而治之

| 代理 | 角色 | 任务 |
|------|------|------|
| Claude | 架构师 | 设计系统，写文档 |
| Codex | 建造者 | 实现核心代码 |
| Gemini | 审查者 | 审查代码，找缺陷 |

### 模式2：红队 / 蓝队

1. **代理 A** 写一个解决方案
2. **代理 B** 试图破坏它（找缺陷、边界情况）
3. **代理 A** 修复问题
4. 重复直到足够健壮

### 模式3：集成方法

给三个代理同样的任务，选最好的方案：

```
同一提示 → Claude → 方案 A
同一提示 → Codex  → 方案 B
同一提示 → Gemini → 方案 C
               ↓
       比较并合并最佳部分
```

### 用 Agent Mail 协调

```bash
am  # 启动邮件服务器

# 代理互相发消息：
# 代理1："数据库模式在 /tmp/schema.sql"
# 代理2："收到，开始 API 层"
```

Agent Mail 还支持 **文件预留** — 代理可以「锁定」文件防止同时编辑。

### 实践示例：构建 Web 应用

1. 用 Beads 规划：前端、后端、数据库、测试、部署
2. 通过 NTM 分配：Claude→后端、Codex→前端、Gemini→测试
3. Agent Mail 协调：后端发信号「API 就绪」→ 前端开始集成
4. UBS 在合并前扫描所有代码
5. CASS 记录全过程供未来参考

### 关键要点

高级工作流用协调模式使用多个代理：分而治之、红蓝对抗或集成。Agent Mail 实现代理间通信和文件锁定。
