# Урок 2. Выбор AI-модели

## Зачем это нужно

AI-модель — это «мозг» вашего ассистента. Разные модели отличаются по скорости, качеству ответов и стоимости. OpenClaw позволяет выбирать модель, переключаться между ними и настраивать автоматическую подмену, если основная модель недоступна.

Это как выбор между разными специалистами: один быстрее, другой точнее, третий дешевле. И вы можете переключаться между ними в любой момент.

---

## Какие модели бывают

OpenClaw работает с моделями от разных **провайдеров** (компаний-разработчиков):

| Провайдер | Популярные модели | Особенности |
|-----------|-------------------|-------------|
| **Anthropic** | Claude Sonnet, Claude Opus | Хороши для сложных задач, анализа, программирования |
| **OpenAI** | GPT-4o, GPT-5 | Универсальные, хороши для общения и текстов |
| **Google** | Gemini | Хороши для поиска информации |
| **OpenRouter** | Доступ к сотням моделей | Единая точка доступа ко многим провайдерам |
| **Ollama** | Локальные модели | Работают на вашем компьютере, бесплатно |

### Формат имени модели

Модели записываются в формате `провайдер/название`:

```
anthropic/claude-sonnet-4-5
openai/gpt-5.2
google/gemini-2.0-flash
```

---

## Как настроить модель

### В файле настроек

```json5
{
  agents: {
    defaults: {
      model: {
        primary: "anthropic/claude-sonnet-4-5",    // основная модель
        fallbacks: ["openai/gpt-5.2"]              // запасные модели
      },
      models: {
        "anthropic/claude-sonnet-4-5": { alias: "Sonnet" },
        "openai/gpt-5.2": { alias: "GPT" }
      }
    }
  }
}
```

> **primary** — основная модель, которая используется по умолчанию.
>
> **fallbacks** — список запасных моделей. Если основная недоступна, OpenClaw автоматически переключится на следующую.
>
> **alias** — короткое имя для удобства (вместо длинного названия можно писать просто «Sonnet»).

### Через командную строку

```bash
# Посмотреть текущую модель и статус
openclaw models status

# Установить основную модель
openclaw models set anthropic/claude-sonnet-4-5

# Посмотреть все доступные модели
openclaw models list --all

# Добавить запасную модель
openclaw models fallbacks add openai/gpt-5.2
```

### Через мастер настройки

```bash
openclaw onboard
```

Мастер проведёт вас через выбор модели и настройку авторизации.

---

## Переключение модели в чате

Прямо во время разговора с ассистентом вы можете сменить модель:

```
/model                        — показать список доступных моделей
/model list                   — то же самое
/model 3                      — выбрать модель номер 3 из списка
/model openai/gpt-5.2         — выбрать конкретную модель
/model status                 — подробная информация о моделях и авторизации
```

Модель меняется **только для текущей сессии** (текущего разговора). При новой сессии вернётся модель по умолчанию.

---

## Авторизация: ключи и подписки

Чтобы использовать модель, нужно подтвердить доступ. Есть два основных способа:

### API-ключ (рекомендуется)

Вы получаете ключ на сайте провайдера и вводите его в OpenClaw. Это как пароль, который подтверждает ваше право использовать модель.

### OAuth-подписка

Некоторые провайдеры (OpenAI, Anthropic) позволяют использовать вашу платную подписку. Это удобно: не нужно отдельно платить за API.

**Для Anthropic (Claude Pro/Max):**
```bash
claude setup-token
openclaw models auth setup-token --provider anthropic
```

**Для OpenAI (ChatGPT Plus):**
```bash
openclaw onboard
# Выберите "openai-codex" в разделе авторизации
```

### Проверка авторизации

```bash
openclaw models status
```

Эта команда покажет, какие провайдеры подключены, какие ключи работают, а какие скоро истекут.

---

## Автоматическая подмена (Failover)

**Failover** (файловер) — это автоматическое переключение на запасной вариант при сбое. Работает в два этапа:

### Этап 1: Ротация профилей авторизации

Если у вас несколько ключей для одного провайдера (например, рабочий и личный аккаунт OpenAI), OpenClaw сначала попробует другой ключ того же провайдера.

### Этап 2: Переход к запасной модели

Если все ключи провайдера не сработали, OpenClaw переходит к следующей модели из списка `fallbacks`.

### Кулдауны (паузы после ошибок)

Если ключ получил ошибку (превышен лимит, нет средств), OpenClaw временно «замораживает» его:

- Первая ошибка → пауза 1 минута
- Вторая → 5 минут
- Третья → 25 минут
- Максимум → 1 час

После успешного запроса все паузы сбрасываются.

> **Совет**: Настройте хотя бы одну запасную модель от **другого** провайдера. Тогда если у одного провайдера проблемы, ваш ассистент продолжит работать.

---

## Пример полной настройки

```json5
{
  agents: {
    defaults: {
      model: {
        primary: "anthropic/claude-sonnet-4-5",
        fallbacks: ["openai/gpt-5.2", "google/gemini-2.0-flash"]
      },
      models: {
        "anthropic/claude-sonnet-4-5": { alias: "Sonnet" },
        "anthropic/claude-opus-4-6": { alias: "Opus" },
        "openai/gpt-5.2": { alias: "GPT" },
        "google/gemini-2.0-flash": { alias: "Gemini" }
      }
    }
  }
}
```

В этом примере:
- Основная модель — Claude Sonnet
- Если она недоступна — переключится на GPT
- Если и GPT недоступен — на Gemini
- В чате можно переключаться между всеми четырьмя моделями

---

## Итоги урока

- **AI-модель** — это «мозг» ассистента; разные модели подходят для разных задач
- Модели записываются в формате `провайдер/название`
- **primary** — основная модель, **fallbacks** — запасные
- Переключаться между моделями можно прямо в чате командой `/model`
- Для доступа нужен **API-ключ** или **OAuth-подписка**
- **Failover** автоматически переключает на запасную модель при сбоях
- Рекомендуется настроить запасные модели от разных провайдеров

---

*Следующий урок: [Память и контекст](03-memory-context.md)*
