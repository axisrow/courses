# Урок 3. Память и контекст

## Зачем это нужно

Представьте, что вы разговариваете с человеком, который забывает всё через час. Неудобно, правда? Система памяти OpenClaw решает эту проблему: ассистент запоминает важные вещи, ведёт заметки и может вспомнить то, о чём вы говорили вчера или на прошлой неделе.

---

## Два ключевых понятия: контекст и память

### Контекст — «оперативная память»

**Контекст** — это всё, что модель видит прямо сейчас в текущем разговоре. У каждой модели есть ограничение — **контекстное окно** (сколько текста она может «удержать в голове» за раз).

Контекст включает:
- Системные инструкции (правила поведения ассистента)
- Историю текущего разговора (ваши сообщения и ответы)
- Результаты вызова инструментов (поиск, файлы, команды)

Чтобы узнать, насколько заполнено окно контекста:
```
/status          — краткий обзор
/context list    — что загружено и сколько места занимает
```

### Память — «записная книжка»

**Память** — это файлы на диске, которые сохраняются между разговорами. Даже если сессия закончилась, записи в памяти остаются.

---

## Как устроена память

Память в OpenClaw — это обычные текстовые файлы в формате Markdown. Они лежат в рабочей папке агента (по умолчанию `~/.openclaw/workspace/`).

### Ежедневные заметки

```
memory/2026-02-18.md    — заметки за сегодня
memory/2026-02-17.md    — заметки за вчера
memory/2026-02-16.md    — заметки за позавчера
...
```

Каждый день — отдельный файл. При старте сессии ассистент читает заметки за сегодня и вчера.

### Долгосрочная память (MEMORY.md)

Файл `MEMORY.md` в корне рабочей папки — это **постоянная память** для важных вещей:
- Ваши предпочтения
- Ключевые решения
- Факты, которые нужны постоянно

> **Совет**: Если хотите, чтобы ассистент что-то запомнил, просто скажите ему: «Запомни, что ...». Он сам запишет это в нужный файл.

---

## Специальные файлы в рабочей папке

### AGENTS.md — «должностная инструкция»

Этот файл описывает, **кто** ваш ассистент и **как** он должен себя вести:

```markdown
# AGENTS.md

Ты — персональный помощник Марии.

## Правила
- Отвечай на русском языке
- Будь кратким, но информативным
- Если не знаешь — честно скажи об этом
```

Ассистент читает этот файл при каждом запуске и следует написанным правилам.

### USER.md — «досье на вас»

Здесь хранится информация о вас, которая помогает ассистенту быть полезнее:

```markdown
# USER.md

- Имя: Мария
- Часовой пояс: Europe/Moscow
- Предпочитаемый язык: русский
- Работает дизайнером в IT-компании
```

### MEMORY.md — «записная книжка»

Постоянная память для важных вещей:

```markdown
# MEMORY.md

## Предпочтения
- Любимый ресторан: «Пушкин» на Тверском бульваре
- Аллергия на арахис

## Проекты
- Редизайн сайта для компании «Стройка» (дедлайн: март 2026)
```

### HEARTBEAT.md — «чек-лист для проверок»

Инструкция для ассистента, что проверять при периодических «пульсах» (подробнее в уроке 6):

```markdown
# HEARTBEAT.md

- Проверить входящие письма
- Есть ли срочные задачи на сегодня?
```

---

## Сессии — «разговоры»

**Сессия** — это один непрерывный разговор с ассистентом. У каждой сессии есть своя история сообщений.

### Управление сессиями

```
/new      — начать новый разговор (старый сохраняется)
/reset    — полный сброс (очистить историю)
/status   — информация о текущей сессии
```

### Автоматический сброс сессий

Можно настроить, чтобы сессии сбрасывались автоматически:

```json5
{
  session: {
    reset: {
      mode: "daily",        // сбрасывать ежедневно
      atHour: 4,            // в 4 утра
      idleMinutes: 120      // или после 2 часов без активности
    }
  }
}
```

---

## Компакция — «сжатие» истории

Когда разговор становится очень длинным и приближается к лимиту контекстного окна, OpenClaw выполняет **компакцию** — сжимает старую часть разговора в краткое резюме.

### Как это работает

1. Ассистент замечает, что окно заполняется
2. Перед сжатием он сохраняет важные заметки в файлы памяти (автоматический «сброс памяти»)
3. Старые сообщения заменяются коротким резюме
4. Новые сообщения остаются как есть

### Ручная компакция

Если чувствуете, что ассистент «запутался» в длинном разговоре:

```
/compact                              — сжать историю
/compact Сосредоточься на вопросах дизайна   — сжать с указанием, что важно сохранить
```

---

## Поиск по памяти

OpenClaw может искать информацию по всем файлам памяти — даже по тем, которые не загружены в текущую сессию. Это работает через **векторный поиск** (семантический — по смыслу, а не только по точным словам).

Например, если вы спросите «когда мы обсуждали ремонт?», ассистент найдёт записи, даже если в них нет слова «ремонт», но есть «строительные работы» или «дизайн квартиры».

Поиск по памяти включён по умолчанию и работает автоматически.

---

## Практические советы

1. **Просите запоминать** — если что-то важно, скажите: «Запомни это» или «Сохрани в память»
2. **Редактируйте файлы** — AGENTS.md, USER.md и MEMORY.md можно редактировать вручную
3. **Начинайте новую сессию** — если разговор зашёл «не туда», используйте `/new`
4. **Используйте компакцию** — в длинных разговорах `/compact` поможет «освежить» контекст
5. **Проверяйте контекст** — `/context list` покажет, что именно видит ассистент

---

## Итоги урока

- **Контекст** — это то, что модель видит прямо сейчас (ограничено окном)
- **Память** — это файлы на диске, которые сохраняются между сессиями
- Ежедневные заметки хранятся в `memory/YYYY-MM-DD.md`
- Постоянная память — в `MEMORY.md`
- **AGENTS.md** задаёт правила поведения, **USER.md** — информацию о вас
- **Компакция** сжимает длинные разговоры, сохраняя суть
- **Поиск по памяти** находит информацию по смыслу, а не только по словам
- Говорите ассистенту «запомни» — и он сохранит информацию в файлы

---

*Следующий урок: [Инструменты ассистента](04-tools.md)*
