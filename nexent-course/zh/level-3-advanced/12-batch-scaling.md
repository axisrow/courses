---
title: "批量处理与流水线"
weight: 12
bookToc: true
---

# 批量处理与流水线

## 何时需要扩展

处理几个文档很简单。但如果需要分析 1000 份报告、处理一整年的发票，或者从整个文档库构建知识库呢？这时就需要 Nexent 的批量处理功能。

## 从单文件到流水线

Nexent 可以平滑地从处理单个文件扩展到大批量：

- **单文件处理** — 上传一个文件，立即获得结果。
- **批量上传** — 一次性将多个文件拖入知识库。
- **流水线模式** — 将多个处理步骤串联起来，完成复杂工作流。

## 设置批量流水线

1. 为批量任务创建一个知识库。
2. 一次上传所有文件（拖放多个文件）。
3. Nexent 在后台排队并处理它们。
4. 在知识库面板中监控进度。

## 处理链

对于每个文档，Nexent 执行以下步骤：

1. **格式检测** — 识别文件类型。
2. **内容提取** — 提取文本、表格、图片。
3. **OCR**（如需要）— 将图片中的文字转为文本。
4. **分块** — 将内容分成可搜索的片段。
5. **嵌入** — 创建向量表示。
6. **摘要** — 生成概览。

## 性能建议

- **硬件很重要。** 更多内存和 CPU 核心可以加速处理。
- **批量处理相似文件。** 处理 100 个 PDF 比混合处理 PDF、表格和图片更快。
- **监控 Elasticsearch。** 检查 `.env` 文件中的 `ES_JAVA_OPTS`，分配足够的堆内存（默认 2 GB）。

## 监控与排错

- 在知识库面板查看处理状态。
- 查看 Docker 日志排查错误：`docker compose logs backend`。
- 失败的文件可以单独重新上传。

## 练习

1. 收集 10 个以上不同格式的文档。
2. 将它们全部上传到同一个知识库。
3. 监控处理进度。
4. 完成后，向智能体提问跨越多个文档的问题。
