---
title: "Celery-воркеры и движок задач"
weight: 12
bookToc: true
---

# Celery-воркеры и движок задач

## Фоновый мозг

Пока FastAPI обрабатывает чат в реальном времени, **Celery** выполняет фоновые задачи. Celery — распределённая очередь задач для Python.

## Ключевые компоненты

| Компонент | Файл | Роль |
|---|---|---|
| Celery App | `workers/celery_app.py` | Настройка экземпляра и брокера (Redis). |
| Определения задач | `workers/tasks.py` | Исполняемые функции задач. |
| Длинные задачи | `workers/long_form_tasks.py` | Многошаговые задачи на несколько минут. |
| Задачи очистки | `workers/retention_tasks.py` | Периодическая очистка данных. |
| Планировщик | `workers/planner/` | AI разбивает цель на шаги. |
| Исполнитель | `workers/executor/` | Выполняет шаги с помощью MCP-инструментов. |

## Конвейер «Планировщик → Исполнитель»

Для сложных задач:
1. **Планировщик** — AI-вызов, разбивающий задачу на упорядоченные шаги.
2. **Исполнитель** — последовательно выполняет шаги, вызывая MCP-инструменты.

## Запуск воркеров

```bash
celery -A workers.celery_app worker --loglevel=info
celery -A workers.celery_app beat --loglevel=info
```

## Масштабирование

```bash
celery -A workers.celery_app worker --concurrency=4
```

Несколько воркеров обрабатывают задачи параллельно.

## Итог

Celery — основа автоматизации Sentient. Понимание воркеров, планировщика и исполнителя даёт полный контроль над фоновой обработкой.
