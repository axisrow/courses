# –£—Ä–æ–∫ 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HAPI

## –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ

HAPI —Ä–∞–±–æ—Ç–∞–µ—Ç ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ù–æ –∏–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å: –ø–æ–º–µ–Ω—è—Ç—å –ø–æ—Ä—Ç, –∑–∞–¥–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å, –ø–æ–¥–∫–ª—é—á–∏—Ç—å Telegram-–±–æ—Ç–∞. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CLI –∏ Hub –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã.

---

## –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–í—Å–µ —Ñ–∞–π–ª—ã HAPI –ª–µ–∂–∞—Ç –≤ –æ–¥–Ω–æ–π –ø–∞–ø–∫–µ:

```
~/.hapi/
‚îú‚îÄ‚îÄ settings.json       # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îú‚îÄ‚îÄ hapi.db            # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–µ—Å—Å–∏–∏, —Å–æ–æ–±—â–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ access.key         # –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ CLI
‚îú‚îÄ‚îÄ runner.state.json  # –°–æ—Å—Ç–æ—è–Ω–∏–µ Runner
‚îî‚îÄ‚îÄ logs/              # –õ–æ–≥–∏ (–∂—É—Ä–Ω–∞–ª—ã —Ä–∞–±–æ—Ç—ã)
```

> **`~`** ‚Äî —ç—Ç–æ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–π –¥–æ–º–∞—à–Ω–µ–π –ø–∞–ø–∫–∏. –ù–∞ macOS —ç—Ç–æ `/Users/–≤–∞—à–µ_–∏–º—è`, –Ω–∞ Linux ‚Äî `/home/–≤–∞—à–µ_–∏–º—è`.

–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —ç—Ç–æ–π –ø–∞–ø–∫–∏:
```bash
export HAPI_HOME="~/my-custom-hapi-folder"
```

---

## –¢—Ä–∏ —Å–ø–æ—Å–æ–±–∞ –∑–∞–¥–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

HAPI —á–∏—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ —Ç—Ä—ë—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤. –ï—Å–ª–∏ –æ–¥–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–¥–∞–Ω–∞ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö, –ø–æ–±–µ–∂–¥–∞–µ—Ç —Ç–æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –≤—ã—à–µ –≤ —Å–ø–∏—Å–∫–µ:

1. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) ‚Äî `export HAPI_LISTEN_PORT=4000`
2. **–§–∞–π–ª settings.json** ‚Äî `~/.hapi/settings.json`
3. **–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** (–Ω–∏–∑—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

> üí° –ï—Å–ª–∏ –≤—ã –∑–∞–¥–∞–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∏ –µ—ë –µ—â—ë –Ω–µ—Ç –≤ settings.json ‚Äî HAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –µ—ë –≤ —Ñ–∞–π–ª –¥–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤.

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Hub

Hub ‚Äî —ç—Ç–æ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å HAPI. –í–æ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

### –°–µ—Ç—å –∏ –¥–æ—Å—Ç—É–ø

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è | settings.json | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------------------|---------------|-------------|----------|
| `HAPI_LISTEN_HOST` | `listenHost` | `127.0.0.1` | –ê–¥—Ä–µ—Å, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º Hub —Å–ª—É—à–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| `HAPI_LISTEN_PORT` | `listenPort` | `3006` | –ü–æ—Ä—Ç Hub |
| `HAPI_PUBLIC_URL` | `publicUrl` | ‚Äî | –ü—É–±–ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑–≤–Ω–µ |
| `CORS_ORIGINS` | `corsOrigins` | ‚Äî | –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ |

> **–ü–æ—Ä—Ç** ‚Äî —ç—Ç–æ –∫–∞–∫ –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –¥–æ–º–µ. IP-–∞–¥—Ä–µ—Å ‚Äî —ç—Ç–æ –∞–¥—Ä–µ—Å –¥–æ–º–∞, –∞ –ø–æ—Ä—Ç —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∫ –∫–∞–∫–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Hub ¬´–∂–∏–≤—ë—Ç¬ª –Ω–∞ –ø–æ—Ä—Ç—É 3006.

> **`127.0.0.1`** (localhost) –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Hub –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —Å –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã Hub –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏, –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ `0.0.0.0`.

**–ü—Ä–∏–º–µ—Ä: —Å–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –Ω–∞ 8080**
```bash
export HAPI_LISTEN_PORT=8080
hapi hub
```

–ò–ª–∏ –≤ `settings.json`:
```json
{
  "listenPort": 8080
}
```

**–ü—Ä–∏–º–µ—Ä: –æ—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏**
```json
{
  "listenHost": "0.0.0.0",
  "listenPort": 3006
}
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | settings.json | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------------|----------|
| `CLI_API_TOKEN` | `cliApiToken` | –û–±—â–∏–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Å–≤—è–∑–∏ CLI –∏ Hub |

–≠—Ç–æ—Ç —Ç–æ–∫–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ. –û–Ω –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã —Ç–æ–ª—å–∫–æ –≤–∞—à CLI –º–æ–≥ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ Hub.

> ‚ö†Ô∏è –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —Å—Ç–∞–ª –∏–∑–≤–µ—Å—Ç–µ–Ω –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–º ‚Äî —É–¥–∞–ª–∏—Ç–µ –µ–≥–æ –∏–∑ `settings.json` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Hub. –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π.

### Telegram

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | settings.json | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------------|----------|
| `TELEGRAM_BOT_TOKEN` | `telegramBotToken` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather |
| `TELEGRAM_NOTIFICATION` | `telegramNotification` | –í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (`true`/`false`) |

### Relay

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `HAPI_RELAY_FORCE_TCP` | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π TCP-—Ä–µ–∂–∏–º (`true`/`false`) |

### –ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `ELEVENLABS_API_KEY` | API-–∫–ª—é—á ElevenLabs |
| `ELEVENLABS_AGENT_ID` | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ ElevenLabs |

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|-------------|----------|
| `DB_PATH` | `~/.hapi/hapi.db` | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ CLI

CLI ‚Äî —ç—Ç–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç AI-–∞–≥–µ–Ω—Ç–∞. –£ –Ω–µ—ë –º–µ–Ω—å—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | settings.json | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------------|-------------|----------|
| `HAPI_API_URL` | `apiUrl` | `http://localhost:3006` | –ê–¥—Ä–µ—Å Hub –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| `CLI_API_TOKEN` | `cliApiToken` | ‚Äî | –¢–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| `HAPI_HOME` | ‚Äî | `~/.hapi` | –ü–∞–ø–∫–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ |
| `HAPI_EXPERIMENTAL` | ‚Äî | `false` | –í–∫–ª—é—á–∏—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ |

**–ü—Ä–∏–º–µ—Ä: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ CLI –∫ —É–¥–∞–ª—ë–Ω–Ω–æ–º—É Hub**
```bash
export HAPI_API_URL="https://–º–æ–π-—Å–µ—Ä–≤–µ—Ä.com"
export CLI_API_TOKEN="–º–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-—Ç–æ–∫–µ–Ω"
hapi
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:
```bash
hapi auth login     # –í–æ–π—Ç–∏
hapi auth status    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
hapi auth logout    # –í—ã–π—Ç–∏
```

---

## –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ settings.json

–í–æ—Ç –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏:

```json
{
  "$schema": "https://hapi.run/docs/schemas/settings.schema.json",
  "listenHost": "0.0.0.0",
  "listenPort": 3006,
  "publicUrl": "https://hapi.example.com",
  "telegramBotToken": "123456:ABC-DEF...",
  "telegramNotification": true,
  "corsOrigins": "https://hapi.example.com"
}
```

> üí° –ü–æ–ª–µ `$schema` –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –µ—Å–ª–∏ –≤–∞—à —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç JSON Schema, –æ–Ω –±—É–¥–µ—Ç –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ—à–∏–±–∫–∏.

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–∞–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ

–ù–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ! –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–¥—Ö–æ–¥—è—Ç:
```bash
hapi hub    # Hub –Ω–∞ localhost:3006
hapi        # CLI –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Relay + Telegram

```bash
export TELEGRAM_BOT_TOKEN="–≤–∞—à-—Ç–æ–∫–µ–Ω-–±–æ—Ç–∞"
export ELEVENLABS_API_KEY="–≤–∞—à-–∫–ª—é—á"
hapi hub --relay
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –æ–¥–Ω–æ–º—É Hub

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
hapi hub
```

–ù–∞ –∫–∞–∂–¥–æ–º —Ä–∞–±–æ—á–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:
```bash
export HAPI_API_URL="http://–∞–¥—Ä–µ—Å-—Å–µ—Ä–≤–µ—Ä–∞:3006"
export CLI_API_TOKEN="–æ–±—â–∏–π-—Ç–æ–∫–µ–Ω"
hapi
```

–ö–∞–∂–¥—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID ‚Äî —Ç–∞–∫ Hub —Ä–∞–∑–ª–∏—á–∞–µ—Ç –º–∞—à–∏–Ω—ã.

---

## –ò—Ç–æ–≥–∏ —É—Ä–æ–∫–∞

- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `~/.hapi/`, –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª ‚Äî `settings.json`
- –¢—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è > settings.json > –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Hub: –ø–æ—Ä—Ç (`3006`), –∞–¥—Ä–µ—Å (`127.0.0.1`), —Ç–æ–∫–µ–Ω, Telegram
- CLI –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `HAPI_API_URL` –∏ `CLI_API_TOKEN`
- –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–¥—Ö–æ–¥—è—Ç ‚Äî –º–µ–Ω—è—Ç—å —á—Ç–æ-—Ç–æ –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Å–æ–±—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö
